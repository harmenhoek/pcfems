{% extends "ems_manage/manage_base.html" %}
{% load humanize %}
{% block tabmanage1_active %}
active
{% endblock tabmanage1_active %}
{% block manage_submenu %}
<div>
    <h2 style="display: inline-block">Dashboard</h2>
    <span class="badge rounded-pill bg-secondary" style="vertical-align: top">Beta</span>
</div>

<div class="float-end my-2">
    {% include "ems/help_modal.html" with title="Dashboard" help_file="ems_manage/help.html" help_section="dashboard" %}
</div>

{% endblock manage_submenu %}
{% block content %}
    {% load ems_customfilters %}

<!--What comes here:-->
<!-- - Item currently in use and total items &ndash;&gt; counter and in pi graph-->
<!-- - Users activity: user interactions per month-->
<!-- - Items overdue-->
<!-- - Items flagged.
- Latest assigned items
- Number of items with flag
- Overdue items
-


Activity by time and week of the day: https://apexcharts.com/javascript-chart-demos/heatmap-charts/color-range/


-->
<!--<div class="row row-cols-1 g-4 mt-1 mb-4">-->
<!--    <div class="col">-->
<!--        <div class="card h-100">-->
<!--            <div class="card-body">-->
<!--                <h6 class="card-subtitle mb-2">Dashboard</h6>-->
<!--                <div>-->
<!--                    <p>There are XX items</p>-->
<!--                    <p>There are XXX items with a High Check priority &ndash;&gt; check</p>-->
<!--                    <p>There are xxx items lost</p>-->
<!--                    <p>XX users, YY logged in in the past 3 months</p>-->
<!--                    <p>XX Items scanned in the last 3 months</p>-->
<!--                    <p>XX Items with open flag</p>-->
<!--                    <p>XX Items assigned (percentage)</p>-->

<!--                    Make horizontal bar graph: total items - check priorities - -->

<!--                    Actions required.-->


<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<div class="row row-cols-1 row-cols-xxl-4 row-cols-xl-3 row-cols-lg-2 row-cols-md-2 row-cols-sm-1 g-4">

    <div class="col">
        <div class="card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2">Total Items</h6>
                <h4 class="card-title">{{ cntitems_total }}</h4>
                <div id="chart"></div>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="card h-100">
            <div class="card-body">
                <h6 class="card-title ">Items per lab</h6>
                <div id="chart2"></div>
                <p class="text-muted">This included items in use and in storage.</p>
                <div>
                     <table id="lab_list" class="table table-striped responsive nowrap table-hover" style="width:100%">
                         <thead>
                         <tr>
                            <th>Lab</th>
                            <th>Items</th>
                         </tr>
                         </thead>
                         <tbody>
                            {% for key, value in summed.items %}
                                <tr>
                                    <td>{{ key }}</td>
                                    <td>{{ value }}</td>
                                </tr>
                         {% endfor %}
                         </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Time evolution total number of items</h6>
<!--                <h4 class="card-title">{{ cntitems_storage.1.storage_location.number }}</h4>-->
                <h4 class="card-title">
                <div id="chart3"></div>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="card h-100">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Items per user</h6>
                <h4 class="card-title"></h4>
                <div id="chart4"></div>
                <div>
                     <table id="user_list" class="table table-striped responsive nowrap table-hover" style="width:100%">
                         <thead>
                         <tr>
                            <th>User</th>
                            <th>Items in use</th>
                         </tr>
                         </thead>
                         <tbody>
                         {% for val in cntitems_peruser %}
                            {% for key, value in val.items %}
                                <tr style="cursor:pointer;" onclick="window.location='{% url 'profile' value.1 %}';">
                                    <td>{{ key }} {{ value.2 }}</td>
                                    <td>{{ value.0 }}</td>
                                </tr>
                            {% endfor %}
                         {% endfor %}
                         </tbody>
                    </table>

                </div>
            </div>
        </div>
    </div>

</div>
<!--<div class="row row-cols-1 g-4 mt-1">-->
<!--    <div class="col">-->
<!--        <div class="card h-100">-->
<!--            <div class="card-body">-->
<!--                <h6 class="card-subtitle mb-2 text-muted">User activity</h6>-->
<!--                <div id="chart5"></div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<script>
    var options = {
          series: [{{ cntitems_available }}, {{ cntitems_usegeneral }}, {{ cntitems_usepersonal }}, {{ cntitems_notracking }}],
          chart: {
          width: '100%',
          type: 'pie',
        },
        labels: ['Available', 'In Use (general)', 'In Use (personal)', 'Untracked'],
        colors:['#198754', '#dc3545', '#fd7e14', '#ced4da'],
        responsive: [{
          breakpoint: 480,
          options: {
            chart: {
              width: 200
            }
          }
        }],
        legend: {
              position: 'bottom'
            }
        };
        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();



        var options = {
          series: [
          {
            data: [
                {%  for key, value in summed.items %}
                    {x: '{{ key }}', y:{{ value }} },
                {% endfor %}
                {x : 'LOST', y: {{ cntitems_lost }} }
            ]
          }
        ],
          legend: {
          show: false
        },
        chart: {
          height: 350,
          type: 'treemap'
        },
        title: {
          text: ''
        }
        };
        var chart = new ApexCharts(document.querySelector("#chart2"), options);
        chart.render();




       var options = {
            series: [{
              name: '0:00-2:00',
              data: [0, 23, 24, 56, 43, 10, 4]
            },
            {
              name: '2:00-4:00',
              data: [3, 44, 24, 32, 44, 5, 23]
            },
            {
              name: '4:00-6:00',
              data: [24, 32, 18, 3, 34, 5, 23]
            },
            {
              name: '6:00-8:00',
              data: [33, 144, 34, 52, 46, 35, 10]
            },
            {
              name: '8:00-10:00',
              data: [13, 144, 124, 32, 144, 45, 23]
            }
            ],
              chart: {
              height: 350,
              type: 'heatmap',
            },
            dataLabels: {
              enabled: false
            },
            colors: ["#008FFB"],
            title: {
              text: 'HeatMap Chart (Single color)'
            },

       };

        var chart = new ApexCharts(document.querySelector("#chart5"), options);
        chart.render();



        var x_arr = {{ xdata }};
        var y_arr = {{ ydata }};


var options = {
  series: [{
  name: 'Living room',
  data: y_arr
}],
  chart: {
  type: 'line',
  animations: {
   enabled: false
  },
  stacked: false,
  height: 400,
  zoom: {
    type: 'x',
    enabled: true,
    autoScaleYaxis: true
  },
  toolbar: {
    autoSelected: 'zoom'
  }
},
dataLabels: {
  enabled: false
},
markers: {
  size: 0,
},
title: {
  text: '',
  align: 'left'
},

xaxis: {
  type: 'datetime',
  categories: x_arr
}
};

        var chart = new ApexCharts(document.querySelector("#chart3"), options);
        chart.render();




var options = {
          series: [
          {
            data: [
                {% for val in cntitems_peruser %}
                    {%  for key, value in val.items %}
                        {x: '{{ key }}', y:{{ value.0 }} },
                    {% endfor %}
                {% endfor %}
            ]
          }
        ],
          chart: {
          width: '100%',
          type: 'treemap',
        },
        legend: {
              show: false
            }
        };
        var chart = new ApexCharts(document.querySelector("#chart4"), options);
        chart.render();



</script>






{% endblock content %}

{% block tablescript %}
{# Code block for javascript table #}

<script>
    $(document).ready(function() {
        $('#user_list').DataTable({
            "order": [[ 0, "asc" ]],
            },
        } );
    } );

      $(document).ready(function() {
        $('#lab_list').DataTable({
            "order": [[ 1, "asc" ]],
            },
        } );
    } );

</script>

{% endblock tablescript %}